<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voicify</title>
    <meta name="description" content="Our first page" />
    <meta name="keywords" content="html tutorial template" />
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body,
      html {
        font-family: Manrope;
      }
    </style>
  </head>
  <body>
    <div class="isolate bg-white px-6 py-24 sm:py-32 lg:px-8">
      <div class="absolute inset-x-0 top-[-10rem] -z-10 transform-gpu overflow-hidden blur-3xl sm:top-[-20rem]" aria-hidden="true">
        <div
          class="relative left-1/2 -z-10 aspect-[1155/678] w-[36.125rem] max-w-none -translate-x-1/2 rotate-[30deg] bg-gradient-to-tr from-[#ff80b5] to-[#9089fc] opacity-30 sm:left-[calc(50%-40rem)] sm:w-[72.1875rem]"
          style="
            clip-path: polygon(
              74.1% 44.1%,
              100% 61.6%,
              97.5% 26.9%,
              85.5% 0.1%,
              80.7% 2%,
              72.5% 32.5%,
              60.2% 62.4%,
              52.4% 68.1%,
              47.5% 58.3%,
              45.2% 34.5%,
              27.5% 76.7%,
              0.1% 64.9%,
              17.9% 100%,
              27.6% 76.8%,
              76.1% 97.7%,
              74.1% 44.1%
            );
          "
        ></div>
      </div>
      <div class="mx-auto max-w-2xl text-center">
        <h2 class="text-3xl tracking-tight text-gray-900 sm:text-xl">Introducing</h2>
        <h2 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-[64px] mt-4 mb-6">VOICIFY</h2>
        <p class="mt-2 text-lg leading-8 text-gray-600">Convert any text into natural-sounding speech with just a few clicks.</p>
      </div>

      <form action="#" class="max-w-xl mx-auto mt-10" method="post">
        <div class="grid grid-cols-1 gap-x-8 gap-y-6 sm:grid-cols-2">
          <div class="sm:col-span-2">
            <div class="mt-2.5">
              <textarea
                type="text"
                name="text"
                maxlength="400"
                placeholder="Enter your text here..."
                class="block w-full py-3 pl-4 pr-4 text-base font-normal leading-7 text-gray-900 placeholder-gray-500 bg-white border border-gray-500 rounded-md focus:ring-white focus:border-white focus:ring-offset-2"
                rows="5"
              ></textarea>
            </div>
          </div>
        </div>
        <div class="mt-10">
          <button
            type="submit"
            class="rounded-lg inline-flex items-center justify-center w-full px-4 py-4 text-sm font-bold tracking-widest text-white uppercase transition-all duration-200 bg-gray-900 border border-transparent focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-white hover:bg-gray-700"
          >
            <span>Try it now!</span>
            <div id="loading" class="hidden">Loading..</div>
          </button>
        </div>
        <div class="mt-8 border-t hidden" id="result">
          <audio controls class="w-full mt-8" id="audio_output" src="{{ url_for('static', filename='tts_output.wav') }}"></audio>
          <div
            id="download"
            class="cursor-pointer mt-5 rounded-lg inline-flex items-center justify-center w-full px-4 py-4 text-sm font-bold tracking-widest text-white uppercase transition-all duration-200 bg-blue-400 border border-transparent focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-white hover:bg-gray-700"
          >
            Download file
          </div>
        </div>
      </form>

      <div class="grid grid-cols-1 gap-5 mt-12 sm:grid-cols-2 lg:grid-cols-3 lg:mt-20 lg:gap-x-12">
        <div class="transition-all duration-200 bg-white hover:shadow-xl">
          <div class="py-10 px-9">
            <svg class="w-16 h-16 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            <h3 class="mt-8 text-lg font-semibold text-black">Simple text to speech</h3>
            <p class="mt-4 text-base text-gray-600">
              A quick way to generate audio from any text for free and without text limit. Generate your audio from any text online
            </p>
          </div>
        </div>

        <div class="transition-all duration-200 bg-white hover:shadow-xl">
          <div class="py-10 px-9">
            <svg class="w-16 h-16 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth="1"
                d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
              />
            </svg>
            <h3 class="mt-8 text-lg font-semibold text-black">Best sound quality</h3>
            <p class="mt-4 text-base text-gray-600">
              You will get the perfect and most clear human voice from your text in a seconds. Start synthesizing your text now
            </p>
          </div>
        </div>

        <div class="transition-all duration-200 bg-white hover:shadow-xl">
          <div class="py-10 px-9">
            <svg class="w-16 h-16 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth="1"
                d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
              />
            </svg>
            <h3 class="mt-8 text-lg font-semibold text-black">Free and open source</h3>
            <p class="mt-4 text-base text-gray-600">You can fork the code source here and see the creation process on youtube on this channel.</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      let apiError = false;
      let audioFile;

      function isLoading() {
        document.querySelector("#loading").classList.remove("hidden");
        document.querySelector("button span").classList.add("hidden");
      }

      function isNotLoading() {
        document.querySelector("#loading").classList.add("hidden");
        document.querySelector("button span").classList.remove("hidden");
      }

      submit = async (e) => {
        document.querySelector("#result").classList.add("hidden");
        isLoading();

        let data = new FormData(e.target);
        e.preventDefault();

        fetch("/call/voicify", {
          method: "POST",
          body: data,
        })
          .then(async (response) => {
            if (response)
              if (response.status != 200) {
                let data = await response.json();
                apiError = true;
              } else {
                console.log("in else");
                const reader = response.body.getReader();
                return new ReadableStream({
                  start(controller) {
                    return pump();
                    function pump() {
                      return reader.read().then(({ done, value }) => {
                        if (done) {
                          controller.close();
                          return;
                        }
                        controller.enqueue(value);
                        return pump();
                      });
                    }
                  },
                });
              }
          })
          .then((stream) => new Response(stream))
          .then((response) => response.blob())
          .then((blob) => {
            return URL.createObjectURL(blob);
          })
          .then((url) => {
            audioFile = url;
            if (!apiError) {
              document.querySelector("#audio_output").src = url;
              document.querySelector("#result").classList.remove("hidden");
            }

            isNotLoading();
          })
          .catch((err) => {
            console.log("Err: ", err);
          });
      };

      function download() {
        const elem = window.document.createElement("a");
        elem.href = audioFile;
        elem.download = "project1_tts_file.wav";
        document.body.appendChild(elem);
        elem.click();
        document.body.removeChild(elem);
      }

      window.onload = function () {
        document.querySelector("form").addEventListener("submit", submit);
        document.querySelector("#download").addEventListener("click", download);
      };
    </script>
  </body>
</html>
